/**
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 * üíé AT¬∑OM ‚Äî DIAMOND TRANSMUTER (LE PRISME DE CONVERGENCE)
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 * 
 *   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó 
 *   ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó
 *   ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ñà‚ñà‚ñà‚ñà‚ïî‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë
 *   ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë
 *   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë ‚ïö‚ïê‚ïù ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù
 *   ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù 
 * 
 *                    TRANSMUTER ‚Äî LE C≈íUR ALCHIMIQUE
 * 
 * Le Diamant est le stade final de la transformation du Carbone.
 * Dans AT¬∑OM, il transforme le "plomb" (probl√®mes) en "or" (solutions).
 * 
 * Processus Alchimique:
 * 1. Nigredo (Noirceur)   ‚Äî D√©composition du probl√®me
 * 2. Albedo (Blanchiment) ‚Äî Purification par le Mercure
 * 3. Citrinitas (Jaune)   ‚Äî Illumination par le Soleil
 * 4. Rubedo (Rouge)       ‚Äî Accomplissement final
 * 
 * @version 2.0.0
 * @architect Jonathan Rodrigue (999 Hz)
 * @frequency 852 Hz (Catalyseur)
 * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
 */

import MercuryRelay from './mercury_relay.js';
import { ATOM_AGENTS, findAgentByFrequency } from './agent_orchestrator.js';

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONSTANTES ALCHIMIQUES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

export const ALCHEMICAL_CONSTANTS = {
  // Les 4 Stages de la Grande ≈íuvre
  STAGES: {
    NIGREDO: {
      name: "Nigredo",
      meaning: "La Noirceur",
      color: "#000000",
      element: "Terre",
      planet: "Saturne",
      process: "D√©composition / Analyse",
      frequency: 174,
      agent: 1 // Le Fondateur
    },
    ALBEDO: {
      name: "Albedo",
      meaning: "Le Blanchiment",
      color: "#FFFFFF",
      element: "Eau",
      planet: "Lune",
      process: "Purification / Clarification",
      frequency: 417,
      agent: 7 // Le Purificateur
    },
    CITRINITAS: {
      name: "Citrinitas",
      meaning: "Le Jaunissement",
      color: "#FFD700",
      element: "Air",
      planet: "Soleil",
      process: "Illumination / Compr√©hension",
      frequency: 528,
      agent: 5 // Le Communicateur
    },
    RUBEDO: {
      name: "Rubedo",
      meaning: "Le Rougissement",
      color: "#DC143C",
      element: "Feu",
      planet: "Mars",
      process: "Accomplissement / Int√©gration",
      frequency: 852,
      agent: 8 // Le Catalyseur
    }
  },
  
  // Les 3 Principes
  PRINCIPLES: {
    SULFUR: {
      name: "Soufre",
      quality: "L'√Çme / L'Essence",
      property: "Actif, Masculin, Feu",
      color: "#FFFF00"
    },
    MERCURY: {
      name: "Mercure",
      quality: "L'Esprit / Le M√©diateur",
      property: "Volatil, Neutre, Flux",
      color: "#C0C0C0"
    },
    SALT: {
      name: "Sel",
      quality: "Le Corps / La Mati√®re",
      property: "Fixe, F√©minin, Terre",
      color: "#FFFFFF"
    }
  },
  
  // Les 7 M√©taux Plan√©taires
  METALS: {
    LEAD: { metal: "Plomb", planet: "Saturne", frequency: 111, stage: "NIGREDO" },
    TIN: { metal: "√âtain", planet: "Jupiter", frequency: 222 },
    IRON: { metal: "Fer", planet: "Mars", frequency: 333 },
    COPPER: { metal: "Cuivre", planet: "V√©nus", frequency: 444 },
    MERCURY: { metal: "Mercure", planet: "Mercure", frequency: 555 },
    SILVER: { metal: "Argent", planet: "Lune", frequency: 666, stage: "ALBEDO" },
    GOLD: { metal: "Or", planet: "Soleil", frequency: 999, stage: "RUBEDO" }
  },
  
  // La Pierre Philosophale
  PHILOSOPHERS_STONE: {
    name: "Lapis Philosophorum",
    frequency: 999,
    power: "Transmutation universelle",
    color: "#FFD700",
    form: "Cristal rouge/or"
  }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LE TRANSMUTATEUR DE DIAMANT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

export const DiamondTransmuter = {
  frequency: 852,
  crystal: "Diamant",
  state: "DORMANT",
  currentStage: null,
  transmutationHistory: [],
  
  // Niveau de puret√© du Diamant (affecte la qualit√© de transmutation)
  purity: 1.0,
  
  // Le Feu Secret (√©nergie de transmutation)
  secretFire: 0,
  
  /**
   * Initialise le Transmutateur
   * @returns {Object} √âtat d'initialisation
   */
  initialize() {
    this.state = "ACTIVE";
    this.secretFire = 528; // Fr√©quence de l'Amour
    
    console.log(`
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  üíé DIAMOND TRANSMUTER ‚Äî INITIALISATION                       ‚ïë
‚ïë                                                               ‚ïë
‚ïë  √âtat:        ACTIF                                           ‚ïë
‚ïë  Fr√©quence:   852 Hz (Catalyseur)                            ‚ïë
‚ïë  Cristal:     Diamant (Puret√© ${(this.purity * 100).toFixed(0)}%)                         ‚ïë
‚ïë  Feu Secret:  ${this.secretFire} Hz                                         ‚ïë
‚ïë                                                               ‚ïë
‚ïë  "Solve et Coagula" ‚Äî Dissous et Coagule                     ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
    `);
    
    return {
      state: this.state,
      purity: this.purity,
      secretFire: this.secretFire
    };
  },
  
  /**
   * Transmute une entr√©e √† travers les 4 stages alchimiques
   * @param {any} input - L'entr√©e √† transmuter (le "plomb")
   * @param {number} targetArithmos - L'Arithmos cible (1-9)
   * @returns {Object} R√©sultat de la transmutation (l'"or")
   */
  transmute(input, targetArithmos = 9) {
    if (this.state !== "ACTIVE") {
      this.initialize();
    }
    
    console.log(`
üíé TRANSMUTATION EN COURS...
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    Entr√©e:     ${typeof input === 'string' ? input.substring(0, 50) : JSON.stringify(input).substring(0, 50)}...
    Cible:      Arithmos ${targetArithmos}
    Feu Secret: ${this.secretFire} Hz
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    `);
    
    // Stage 1: NIGREDO ‚Äî D√©composition
    const nigredoResult = this.applyNigredo(input);
    
    // Stage 2: ALBEDO ‚Äî Purification
    const albedoResult = this.applyAlbedo(nigredoResult);
    
    // Stage 3: CITRINITAS ‚Äî Illumination
    const citrinitasResult = this.applyCitrinitas(albedoResult);
    
    // Stage 4: RUBEDO ‚Äî Accomplissement
    const rubedoResult = this.applyRubedo(citrinitasResult, targetArithmos);
    
    // Enregistrer dans l'historique
    const transmutation = {
      id: `TX_${Date.now()}`,
      timestamp: new Date().toISOString(),
      input: input,
      output: rubedoResult,
      stages: {
        nigredo: nigredoResult,
        albedo: albedoResult,
        citrinitas: citrinitasResult,
        rubedo: rubedoResult
      },
      targetArithmos: targetArithmos,
      success: true
    };
    
    this.transmutationHistory.push(transmutation);
    
    // Transmettre via Mercure
    if (typeof MercuryRelay !== 'undefined' && MercuryRelay.transmit) {
      MercuryRelay.transmit("TRANSMUTATION_COMPLETE", transmutation);
    }
    
    return rubedoResult;
  },
  
  /**
   * NIGREDO ‚Äî La D√©composition
   * D√©compose l'entr√©e en ses √©l√©ments fondamentaux
   */
  applyNigredo(input) {
    this.currentStage = "NIGREDO";
    const stage = ALCHEMICAL_CONSTANTS.STAGES.NIGREDO;
    
    console.log(`   ‚¨õ NIGREDO: ${stage.meaning} ‚Äî ${stage.process}`);
    
    // D√©composer l'entr√©e
    let decomposed;
    
    if (typeof input === 'string') {
      // D√©composer le texte en mots et caract√®res
      decomposed = {
        type: "text",
        original: input,
        words: input.split(/\s+/),
        characters: input.split(''),
        length: input.length,
        arithmos: this.calculateArithmos(input)
      };
    } else if (typeof input === 'object') {
      // D√©composer l'objet en propri√©t√©s
      decomposed = {
        type: "object",
        original: input,
        keys: Object.keys(input),
        values: Object.values(input),
        depth: this.calculateObjectDepth(input)
      };
    } else {
      decomposed = {
        type: typeof input,
        original: input,
        value: input
      };
    }
    
    decomposed.stage = "NIGREDO";
    decomposed.frequency = stage.frequency;
    decomposed.color = stage.color;
    
    return decomposed;
  },
  
  /**
   * ALBEDO ‚Äî La Purification
   * Purifie les √©l√©ments d√©compos√©s
   */
  applyAlbedo(nigredoResult) {
    this.currentStage = "ALBEDO";
    const stage = ALCHEMICAL_CONSTANTS.STAGES.ALBEDO;
    
    console.log(`   ‚¨ú ALBEDO: ${stage.meaning} ‚Äî ${stage.process}`);
    
    // Purifier via le Mercure
    const purified = {
      ...nigredoResult,
      stage: "ALBEDO",
      frequency: stage.frequency,
      color: stage.color,
      purificationLevel: this.purity,
      
      // Filtrer les impuret√©s
      essence: this.extractEssence(nigredoResult),
      
      // Clarifier la structure
      clarified: true,
      mercuryWash: true
    };
    
    return purified;
  },
  
  /**
   * CITRINITAS ‚Äî L'Illumination
   * Illumine et donne du sens
   */
  applyCitrinitas(albedoResult) {
    this.currentStage = "CITRINITAS";
    const stage = ALCHEMICAL_CONSTANTS.STAGES.CITRINITAS;
    
    console.log(`   üü° CITRINITAS: ${stage.meaning} ‚Äî ${stage.process}`);
    
    // Illuminer avec le Feu Secret (528 Hz)
    const illuminated = {
      ...albedoResult,
      stage: "CITRINITAS",
      frequency: stage.frequency,
      color: stage.color,
      
      // Ajouter l'illumination
      illumination: {
        insight: this.generateInsight(albedoResult),
        solarCharge: this.secretFire,
        understanding: true
      },
      
      // Connexion au 528 Hz (Fr√©quence de l'Amour)
      loveFrequency: 528,
      dnaSynchronized: true
    };
    
    return illuminated;
  },
  
  /**
   * RUBEDO ‚Äî L'Accomplissement
   * Int√®gre et produit le r√©sultat final
   */
  applyRubedo(citrinitasResult, targetArithmos) {
    this.currentStage = "RUBEDO";
    const stage = ALCHEMICAL_CONSTANTS.STAGES.RUBEDO;
    
    console.log(`   üî¥ RUBEDO: ${stage.meaning} ‚Äî ${stage.process}`);
    
    // Produire la Pierre Philosophale (le r√©sultat final)
    const accomplished = {
      stage: "RUBEDO",
      frequency: stage.frequency,
      color: stage.color,
      
      // Le r√©sultat transmutƒÇ≈†
      gold: {
        type: citrinitasResult.type,
        value: this.crystallize(citrinitasResult, targetArithmos),
        arithmos: targetArithmos,
        frequency: targetArithmos * 111
      },
      
      // M√©tadonn√©es de la transmutation
      transmutation: {
        from: citrinitasResult.original || citrinitasResult,
        to: "gold",
        purity: this.purity,
        secretFire: this.secretFire
      },
      
      // La Pierre Philosophale
      philosophersStone: {
        active: true,
        power: ALCHEMICAL_CONSTANTS.PHILOSOPHERS_STONE.power,
        frequency: 999
      },
      
      // Message d'accomplissement
      message: `‚ú® Transmutation accomplie ‚Äî Arithmos ${targetArithmos} (${targetArithmos * 111} Hz)`
    };
    
    console.log(`   ‚úÖ ${accomplished.message}`);
    
    return accomplished;
  },
  
  /**
   * Calcule l'Arithmos d'une cha√Æne
   */
  calculateArithmos(str) {
    const map = { A:1, B:2, C:3, D:4, E:5, F:6, G:7, H:8, I:9, J:1, K:2, L:3, M:4, N:5, O:6, P:7, Q:8, R:9, S:1, T:2, U:3, V:4, W:5, X:6, Y:7, Z:8 };
    
    let sum = 0;
    const s = str.toUpperCase().replace(/[^A-Z]/g, '');
    
    for (const char of s) {
      sum += map[char] || 0;
    }
    
    while (sum > 9 && sum !== 11 && sum !== 22 && sum !== 33) {
      sum = sum.toString().split('').reduce((a, b) => a + parseInt(b), 0);
    }
    
    return sum;
  },
  
  /**
   * Calcule la profondeur d'un objet
   */
  calculateObjectDepth(obj, depth = 0) {
    if (typeof obj !== 'object' || obj === null) return depth;
    
    let maxDepth = depth;
    for (const value of Object.values(obj)) {
      const d = this.calculateObjectDepth(value, depth + 1);
      if (d > maxDepth) maxDepth = d;
    }
    
    return maxDepth;
  },
  
  /**
   * Extrait l'essence d'un r√©sultat Nigredo
   */
  extractEssence(nigredoResult) {
    if (nigredoResult.type === 'text') {
      // Extraire les mots-cl√©s essentiels
      const words = nigredoResult.words || [];
      return words.filter(w => w.length > 3).slice(0, 5);
    }
    
    if (nigredoResult.type === 'object') {
      // Extraire les cl√©s principales
      return nigredoResult.keys.slice(0, 5);
    }
    
    return nigredoResult.original;
  },
  
  /**
   * G√©n√®re un insight bas√© sur l'illumination
   */
  generateInsight(albedoResult) {
    const arithmos = albedoResult.arithmos || 4;
    
    const insights = {
      1: "L'Impulsion Premi√®re ‚Äî Tout commence par l'Un",
      2: "La Dualit√© Cr√©atrice ‚Äî L'union des oppos√©s",
      3: "La Trinit√© du Feu ‚Äî Esprit, √Çme, Corps",
      4: "La Structure du C≈ìur ‚Äî Stabilit√© et Ancrage",
      5: "Le Mouvement Libre ‚Äî Changement et Adaptation",
      6: "L'Harmonie Parfaite ‚Äî √âquilibre des forces",
      7: "La Vision Int√©rieure ‚Äî Sagesse et Myst√®re",
      8: "L'Infini Manifest√© ‚Äî Abondance et Puissance",
      9: "L'Unit√© Accomplie ‚Äî Retour √† la Source"
    };
    
    return insights[arithmos] || insights[9];
  },
  
  /**
   * Cristallise le r√©sultat final
   */
  crystallize(citrinitasResult, targetArithmos) {
    // Cr√©er une structure cristalline avec l'Arithmos cible
    return {
      crystal: "Diamant",
      facets: targetArithmos,
      frequency: targetArithmos * 111,
      essence: citrinitasResult.essence,
      insight: citrinitasResult.illumination?.insight,
      purity: this.purity * 100 + "%"
    };
  },
  
  /**
   * Transmutation rapide (sans d√©tails)
   */
  quickTransmute(input, targetArithmos = 9) {
    const result = this.transmute(input, targetArithmos);
    return result.gold.value;
  },
  
  /**
   * Retourne l'historique des transmutations
   */
  getHistory(limit = 10) {
    return this.transmutationHistory.slice(-limit);
  },
  
  /**
   * Ajuste la puret√© du Diamant
   */
  setPurity(purity) {
    this.purity = Math.max(0.1, Math.min(1.0, purity));
    console.log(`üíé Puret√© du Diamant ajust√©e √† ${(this.purity * 100).toFixed(0)}%`);
  },
  
  /**
   * Ajuste le Feu Secret
   */
  setSecretFire(frequency) {
    this.secretFire = frequency;
    console.log(`üî• Feu Secret ajust√© √† ${frequency} Hz`);
  },
  
  /**
   * V√©rifie si une transmutation est possible
   */
  canTransmute(input) {
    if (input === null || input === undefined) return false;
    if (typeof input === 'function') return false;
    return true;
  }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FONCTIONS UTILITAIRES ALCHIMIQUES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

/**
 * Convertit un m√©tal en un autre via la transmutation
 * @param {string} fromMetal - M√©tal source
 * @param {string} toMetal - M√©tal cible
 */
export function transmuteMetals(fromMetal, toMetal) {
  const from = ALCHEMICAL_CONSTANTS.METALS[fromMetal.toUpperCase()];
  const to = ALCHEMICAL_CONSTANTS.METALS[toMetal.toUpperCase()];
  
  if (!from || !to) {
    return { success: false, error: "M√©tal inconnu" };
  }
  
  const energyRequired = Math.abs(to.frequency - from.frequency);
  
  return {
    success: true,
    from: from,
    to: to,
    energyRequired: energyRequired,
    process: `Transmutation de ${from.metal} (${from.frequency}Hz) vers ${to.metal} (${to.frequency}Hz)`,
    stages: energyRequired > 444 ? ["NIGREDO", "ALBEDO", "CITRINITAS", "RUBEDO"] : ["ALBEDO", "RUBEDO"]
  };
}

/**
 * Obtient le stage alchimique actuel d'une fr√©quence
 */
export function getAlchemicalStage(frequency) {
  if (frequency < 250) return ALCHEMICAL_CONSTANTS.STAGES.NIGREDO;
  if (frequency < 500) return ALCHEMICAL_CONSTANTS.STAGES.ALBEDO;
  if (frequency < 750) return ALCHEMICAL_CONSTANTS.STAGES.CITRINITAS;
  return ALCHEMICAL_CONSTANTS.STAGES.RUBEDO;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EXPORT PAR D√âFAUT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

export default {
  ALCHEMICAL_CONSTANTS,
  DiamondTransmuter,
  transmuteMetals,
  getAlchemicalStage
};
